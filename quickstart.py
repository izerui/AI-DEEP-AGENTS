"""
Deep Agents å¿«é€Ÿå…¥é—¨æŒ‡å—
ä»é›¶å¼€å§‹ï¼Œ5åˆ†é’ŸæŒæ¡ Deep Agents çš„æ ¸å¿ƒç”¨æ³•
"""

# ============================================================================
# ç¬¬ä¸€æ­¥ï¼šå®‰è£…
# ============================================================================

# æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œï¼š
# pip install deepagents

# ============================================================================
# ç¬¬äºŒæ­¥ï¼šåˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªå·¥å…·
# ============================================================================

from langchain_core.tools import tool

@tool
def calculator(a: float, b: float, operation: str) -> str:
    """
    æ‰§è¡ŒåŸºæœ¬æ•°å­¦è¿ç®—
    
    Args:
        a: ç¬¬ä¸€ä¸ªæ•°å­—
        b: ç¬¬äºŒä¸ªæ•°å­—
        operation: æ“ä½œç±»å‹ (add, subtract, multiply, divide)
    
    Returns:
        è®¡ç®—ç»“æœ
    """
    if operation == "add":
        return f"{a} + {b} = {a + b}"
    elif operation == "subtract":
        return f"{a} - {b} = {a - b}"
    elif operation == "multiply":
        return f"{a} Ã— {b} = {a * b}"
    elif operation == "divide":
        if b == 0:
            return "é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸ºé›¶"
        return f"{a} Ã· {b} = {a / b}"
    else:
        return f"é”™è¯¯ï¼šæœªçŸ¥æ“ä½œ '{operation}'"


# ============================================================================
# ç¬¬ä¸‰æ­¥ï¼šåˆ›å»º Deep Agentï¼ˆä¸€è¡Œä»£ç ï¼ï¼‰
# ============================================================================

from deepagents import create_deep_agent

# åˆ›å»ºæ™ºèƒ½ä½“
agent = create_deep_agent(
    tools=[calculator],  # ä¼ å…¥å·¥å…·åˆ—è¡¨
    system_prompt="ä½ æ˜¯ä¸€ä¸ªæ•°å­¦åŠ©æ‰‹ï¼Œæ“…é•¿è®¡ç®—ã€‚"
)

# ============================================================================
# ç¬¬å››æ­¥ï¼šè¿è¡Œä»»åŠ¡
# ============================================================================

# æ–¹å¼1ï¼šç®€å•ä»»åŠ¡
task1 = "è®¡ç®— 25 åŠ  18"
result1 = agent.invoke({
    "messages": [{"role": "user", "content": task1}]
})

print("ã€ä»»åŠ¡1ã€‘")
print(f"è¾“å…¥: {task1}")
print(f"è¾“å‡º: {result1['messages'][-1].content}")
print()

# æ–¹å¼2ï¼šå¤æ‚ä»»åŠ¡
task2 = """
å¸®æˆ‘è®¡ç®—ï¼š
1. 100 é™¤ä»¥ 4
2. ç„¶åå°†ç»“æœä¹˜ä»¥ 3
3. ç»™å‡ºæœ€ç»ˆç­”æ¡ˆ
"""
result2 = agent.invoke({
    "messages": [{"role": "user", "content": task2}]
})

print("ã€ä»»åŠ¡2ã€‘")
print(f"è¾“å…¥: {task2}")
print(f"è¾“å‡º: {result2['messages'][-1].content}")
print()

# ============================================================================
# è¿›é˜¶ï¼šæ·»åŠ æ›´å¤šå·¥å…·
# ============================================================================

@tool
def search(query: str) -> str:
    """æœç´¢ä¿¡æ¯ï¼ˆæ¨¡æ‹Ÿï¼‰"""
    knowledge = {
        "python": "Pythonæ˜¯ä¸€ç§é«˜çº§ç¼–ç¨‹è¯­è¨€",
        "langchain": "LangChainæ˜¯AIåº”ç”¨å¼€å‘æ¡†æ¶",
        "deepagents": "Deep Agentsæ˜¯LangChainçš„æ™ºèƒ½ä½“æ¡†æ¶"
    }
    for key, value in knowledge.items():
        if key in query.lower():
            return f"æœç´¢ç»“æœ: {value}"
    return f"æœªæ‰¾åˆ°å…³äº'{query}'çš„ä¿¡æ¯"

@tool
def text_analyzer(text: str, operation: str) -> str:
    """åˆ†ææ–‡æœ¬"""
    if operation == "count_words":
        return f"è¯æ•°: {len(text.split())}"
    elif operation == "to_upper":
        return text.upper()
    else:
        return "æœªçŸ¥æ“ä½œ"

# åˆ›å»ºåŒ…å«å¤šä¸ªå·¥å…·çš„æ™ºèƒ½ä½“
multi_tool_agent = create_deep_agent(
    tools=[calculator, search, text_analyzer],
    system_prompt="""ä½ æ˜¯ä¸€ä¸ªå…¨èƒ½åŠ©æ‰‹ï¼Œå¯ä»¥ï¼š
1. è¿›è¡Œæ•°å­¦è®¡ç®—
2. æœç´¢ä¿¡æ¯
3. åˆ†ææ–‡æœ¬

è¯·æ ¹æ®ä»»åŠ¡é€‰æ‹©åˆé€‚çš„å·¥å…·ã€‚"""
)

# è¿è¡Œå¤šæ­¥éª¤ä»»åŠ¡
task3 = """
è®¡ç®— 50 ä¹˜ä»¥ 2ï¼Œ
ç„¶åæœç´¢å…³äº python çš„ä¿¡æ¯ï¼Œ
ç»Ÿè®¡æœç´¢ç»“æœçš„å­—ç¬¦æ•°
"""
result3 = multi_tool_agent.invoke({
    "messages": [{"role": "user", "content": task3}]
})

print("ã€ä»»åŠ¡3 - å¤šå·¥å…·åä½œã€‘")
print(f"è¾“å…¥: {task3}")
print(f"è¾“å‡º: {result3['messages'][-1].content}")
print()

# ============================================================================
# é«˜çº§ï¼šè‡ªå®šä¹‰ LLM é…ç½®
# ============================================================================

from langchain_openai import ChatOpenAI

# ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹
cost_optimized_llm = ChatOpenAI(
    model="gpt-4o-mini",  # æ¯” GPT-4 ä¾¿å®œ 10 å€
    temperature=0,
)

# åˆ›å»ºæˆæœ¬ä¼˜åŒ–çš„æ™ºèƒ½ä½“
cost_agent = create_deep_agent(
    tools=[calculator],
    llm=cost_optimized_llm,  # ä¼ å…¥è‡ªå®šä¹‰ LLM
    system_prompt="ä½ æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„æ•°å­¦åŠ©æ‰‹ã€‚"
)

task4 = "è®¡ç®— 123 ä¹˜ä»¥ 456"
result4 = cost_agent.invoke({
    "messages": [{"role": "user", "content": task4}]
})

print("ã€ä»»åŠ¡4 - æˆæœ¬ä¼˜åŒ–ã€‘")
print(f"è¾“å…¥: {task4}")
print(f"è¾“å‡º: {result4['messages'][-1].content}")
print(f"ä½¿ç”¨çš„æ¨¡å‹: gpt-4o-miniï¼ˆæˆæœ¬æ›´ä½ï¼‰")
print()

# ============================================================================
# é”™è¯¯å¤„ç†ç¤ºä¾‹
# ============================================================================

task5 = "è®¡ç®— 100 é™¤ä»¥ 0ï¼Œå¦‚æœå¤±è´¥å°±è®¡ç®— 100 é™¤ä»¥ 5"
result5 = agent.invoke({
    "messages": [{"role": "user", "content": task5}]
})

print("ã€ä»»åŠ¡5 - é”™è¯¯æ¢å¤ã€‘")
print(f"è¾“å…¥: {task5}")
print(f"è¾“å‡º: {result5['messages'][-1].content}")
print()

# ============================================================================
# æœ€ä½³å®è·µæ€»ç»“
# ============================================================================

print("=" * 70)
print("ã€Deep Agents æœ€ä½³å®è·µã€‘")
print("=" * 70)

best_practices = """
1. å·¥å…·è®¾è®¡
   - ä¸ºå·¥å…·æä¾›æ¸…æ™°çš„æè¿°
   - ä½¿ç”¨ç±»å‹æç¤ºï¼ˆType Hintsï¼‰
   - åœ¨ docstring ä¸­è¯¦ç»†è¯´æ˜å‚æ•°

2. System Prompt
   - æ˜ç¡®æ™ºèƒ½ä½“çš„è§’è‰²å’Œèƒ½åŠ›
   - è¯´æ˜å¯ç”¨çš„å·¥å…·
   - æŒ‡å®šä»»åŠ¡æ‰§è¡ŒåŸåˆ™

3. æˆæœ¬ä¼˜åŒ–
   - ç®€å•ä»»åŠ¡ç”¨ gpt-4o-mini
   - å¤æ‚ä»»åŠ¡ç”¨ gpt-4
   - æ‰¹é‡å¤„ç†æ—¶è€ƒè™‘æ›´ä¾¿å®œçš„æ¨¡å‹

4. é”™è¯¯å¤„ç†
   - åœ¨å·¥å…·å†…éƒ¨å¤„ç†å¸¸è§é”™è¯¯
   - è¿”å›å‹å¥½çš„é”™è¯¯ä¿¡æ¯
   - è®©æ™ºèƒ½ä½“èƒ½å¤Ÿè‡ªæˆ‘çº æ­£

5. æµ‹è¯•
   - å…ˆç”¨ç®€å•ä»»åŠ¡æµ‹è¯•
   - é€æ­¥å¢åŠ å¤æ‚åº¦
   - å¯¹æ¯”ä¸åŒæ¨¡å‹çš„æ•ˆæœ
"""

print(best_practices)

# ============================================================================
# å¸¸è§é—®é¢˜
# ============================================================================

print("=" * 70)
print("ã€å¸¸è§é—®é¢˜ FAQã€‘")
print("=" * 70)

faqs = """
Q1: Deep Agents å’Œ LangChain çš„åŒºåˆ«ï¼Ÿ
A1: Deep Agents æ˜¯åŸºäº LangChain æ„å»ºçš„é«˜çº§æ¡†æ¶ï¼Œ
    æä¾›å¼€ç®±å³ç”¨çš„æ™ºèƒ½ä½“åŠŸèƒ½ï¼Œæ¯”ç›´æ¥ç”¨ LangChain æ›´ç®€å•ã€‚

Q2: å¦‚ä½•æŸ¥çœ‹æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ
A2: ä½¿ç”¨ verbose æ¨¡å¼æˆ–æ£€æŸ¥è¿”å›çš„ messages åˆ—è¡¨ï¼Œ
    æ¯æ¡æ¶ˆæ¯è®°å½•äº†æ‰§è¡Œçš„ä¸€æ­¥ã€‚

Q3: æ”¯æŒå“ªäº› LLMï¼Ÿ
A3: æ”¯æŒæ‰€æœ‰ LangChain å…¼å®¹çš„æ¨¡å‹ï¼ŒåŒ…æ‹¬ OpenAIã€Anthropic ç­‰ã€‚

Q4: å¯ä»¥é™åˆ¶æ‰§è¡Œæ­¥æ•°å—ï¼Ÿ
A4: å¯ä»¥ï¼Œåœ¨åˆ›å»º agent æ—¶å¯ä»¥é…ç½® max_steps ç­‰å‚æ•°ã€‚

Q5: å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½ï¼Ÿ
A5: å¯ä»¥é€šè¿‡åŒ…è£…å™¨æ¨¡å¼æ·»åŠ ï¼Œä¾‹å¦‚æ·»åŠ åæ€åº“ã€æ—¥å¿—ç­‰ã€‚
"""

print(faqs)

# ============================================================================
# ä¸‹ä¸€æ­¥å­¦ä¹ 
# ============================================================================

print("=" * 70)
print("ã€ä¸‹ä¸€æ­¥å­¦ä¹ ã€‘")
print("=" * 70)

next_steps = """
1. ğŸ“– æŸ¥çœ‹å®Œæ•´ç¤ºä¾‹ï¼š
   python deepagents_demo/deepagents_simple.py

2. ğŸ“Š é˜…è¯»å¯¹æ¯”åˆ†æï¼š
   python deepagents_demo/comparison.py

3. ğŸ”— å®˜æ–¹æ–‡æ¡£ï¼š
   https://docs.langchain.com/oss/python/deepagents/quickstart

4. ğŸ§ª å®æˆ˜é¡¹ç›®ï¼š
   - æ–‡ä»¶åŠ©æ‰‹ï¼ˆè¯»å†™ã€æœç´¢æ–‡ä»¶ï¼‰
   - æ•°æ®åˆ†æåŠ©æ‰‹ï¼ˆå¤„ç†CSVã€å¯è§†åŒ–ï¼‰
   - API é›†æˆåŠ©æ‰‹ï¼ˆè°ƒç”¨å¤–éƒ¨APIï¼‰

5. ğŸš€ è¿›é˜¶ä¸»é¢˜ï¼š
   - æ·»åŠ åæ€åº“
   - å®ç°å¤šæ™ºèƒ½ä½“åä½œ
   - æ·»åŠ æŒä¹…åŒ–è®°å¿†
"""

print(next_steps)

print("\n" + "=" * 70)
print("âœ… æ­å–œï¼ä½ å·²ç»æŒæ¡äº† Deep Agents çš„åŸºç¡€ç”¨æ³•")
print("=" * 70)